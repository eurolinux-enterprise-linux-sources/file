diff --git a/src/elfclass.h b/src/elfclass.h
index 65adcac..c5ac02f 100644
--- a/src/elfclass.h
+++ b/src/elfclass.h
@@ -68,7 +68,7 @@
 		if (doshn(ms, clazz, swap, fd,
 		    (off_t)elf_getu(swap, elfhdr.e_shoff), shnum,
 		    (size_t)elf_getu16(swap, elfhdr.e_shentsize),
-		    fsize, &flags, elf_getu16(swap, elfhdr.e_machine), &notecount) == -1)
+		    fsize, &flags, elf_getu16(swap, elfhdr.e_machine), &notecount, (int)elf_getu16(swap, elfhdr.e_shstrndx)) == -1)
 			return -1;
 		break;
 
diff --git a/src/readelf.c b/src/readelf.c
index 44d1268..fe29cd8 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -50,7 +50,7 @@ private int dophn_core(struct magic_set *, int, int, int, off_t, int, size_t,
 private int dophn_exec(struct magic_set *, int, int, int, off_t, int, size_t,
     off_t, int *, int, uint16_t *);
 private int doshn(struct magic_set *, int, int, int, off_t, int, size_t,
-    off_t, int *, int, uint16_t *);
+    off_t, int *, int, uint16_t *, int);
 private size_t donote(struct magic_set *, void *, size_t, size_t, int,
     int, size_t, int *, int, off_t, int, off_t, uint16_t *);
 
@@ -347,7 +347,7 @@ dophn_core(struct magic_set *ms, int clazz, int swap, int fd, off_t off,
 			file_badseek(ms);
 			return -1;
 		}
-		if (read(fd, xph_addr, xph_sizeof) == -1) {
+		if (read(fd, xph_addr, xph_sizeof) < (ssize_t)xph_sizeof) {
 			file_badread(ms);
 			return -1;
 		}
@@ -371,7 +371,7 @@ dophn_core(struct magic_set *ms, int clazz, int swap, int fd, off_t off,
 		}
 		bufsize = read(fd, nbuf,
 		    ((xph_filesz < sizeof(nbuf)) ? xph_filesz : sizeof(nbuf)));
-		if (bufsize == -1) {
+		if (bufsize < 0 || bufsize < ((xph_filesz < sizeof(nbuf)) ? xph_filesz : sizeof(nbuf))) {
 			file_badread(ms);
 			return -1;
 		}
@@ -1034,7 +1034,7 @@ static const cap_desc_t cap_desc_386[] = {
 
 private int
 doshn(struct magic_set *ms, int clazz, int swap, int fd, off_t off, int num,
-    size_t size, off_t fsize, int *flags, int mach, uint16_t *notecount)
+    size_t size, off_t fsize, int *flags, int mach, uint16_t *notecount, int strtab)
 {
 	Elf32_Shdr sh32;
 	Elf64_Shdr sh64;
@@ -1051,12 +1051,18 @@ doshn(struct magic_set *ms, int clazz, int swap, int fd, off_t off, int num,
 		return 0;
 	}
 
+	/* Read offset of name section to check the ELF file is valid */
+	if (pread(fd, xsh_addr, xsh_sizeof, off + size * strtab) < (ssize_t)xsh_sizeof) {
+		file_badread(ms);
+		return -1;
+	}
+
 	for ( ; num; num--) {
 		if (lseek(fd, off, SEEK_SET) == (off_t)-1) {
 			file_badseek(ms);
 			return -1;
 		}
-		if (read(fd, xsh_addr, xsh_sizeof) == -1) {
+		if (read(fd, xsh_addr, xsh_sizeof) < (ssize_t)xsh_sizeof) {
 			file_badread(ms);
 			return -1;
 		}
@@ -1250,7 +1256,7 @@ dophn_exec(struct magic_set *ms, int clazz, int swap, int fd, off_t off,
 			return -1;
 		}
 
-  		if (read(fd, xph_addr, xph_sizeof) == -1) {
+  		if (read(fd, xph_addr, xph_sizeof) < (ssize_t)xph_sizeof) {
   			file_badread(ms);
 			return -1;
 		}
