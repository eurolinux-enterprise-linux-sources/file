diff --git a/src/softmagic.c b/src/softmagic.c
index f98e976..742cbc8 100644
--- a/src/softmagic.c
+++ b/src/softmagic.c
@@ -956,15 +956,26 @@ mcopy(struct magic_set *ms, union VALUETYPE *p, int type, int indir,
 			const char *last;	/* end of search region */
 			const char *buf;	/* start of search region */
 			const char *end;
-			size_t lines;
+			size_t lines, bytecnt;
 
 			if (s == NULL) {
 				ms->search.s_len = 0;
 				ms->search.s = NULL;
 				return 0;
 			}
+
+			if (linecnt == 0) {
+				linecnt = 1024;
+			}
+
+			if (bytecnt == 0) {
+				bytecnt = linecnt * 100;
+			}
+			if (bytecnt > nbytes)
+				bytecnt = nbytes;
+
 			buf = (const char *)s + offset;
-			end = last = (const char *)s + nbytes;
+			end = last = (const char *)s + bytecnt;
 			/* mget() guarantees buf <= last */
 			for (lines = linecnt, b = buf; lines &&
 			     b < end && c < end &&
@@ -978,7 +989,7 @@ mcopy(struct magic_set *ms, union VALUETYPE *p, int type, int indir,
 					b++;
 			}
 			if (lines)
-				last = (const char *)s + nbytes;
+				last = (const char *)s + bytecnt;
 
 			ms->search.s = buf;
 			ms->search.s_len = last - buf;
